
<% @thistemplate = ::Template.find(params[:id])
   @site = Site.find(params[:site])



    %>
  <div class="row">
		<div class="col-sm-3">


      <%= render "siteContentModel" %>

      <hr>

      <h4>Page Purpose</h4>
      <p><%= @thistemplate.page_purpose %></p>
      <hr>
      <h4>Messaging</h4>
      <% @templatemessage = HierarchyMapping.where template_id: (params[:id]) %>
      <% @templatemessage.each do |h| %>
          <h5><%= h.hierarchy.name.html_safe %></h5>
          <p><%= h.hierarchy.description.html_safe %>
              <p><%= link_to "Audience Message Guide", "#myModal", :class => "btn btn-info align-center", "data-toggle" => "modal" %>
                <!-- , "#my-modal", :class => "btn", "data-toggle" => "modal"  -->
                      <!-- Modal -->
                      <div id="myModal" class="modal fade" role="dialog">
                        <div class="modal-dialog">

                          <!-- Modal content-->
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal">&times;</button>
                              <h3 class="modal-title"><small><%= @site.name %></small><br><%= h.hierarchy.name.html_safe %></h3>
                            </div>
                            <div class="modal-body">

                              <table class="table table-hover">
                                <thead>
                                  <tr>
                                    <th scope="col">Audience</th>
                                    <th scope="col">Message</th>
                                  </tr>
                                </thead>
                                <tbody>


                                <% @audiencemessage = AudienceMessage.joins(:audience, :site).where(hierarchy_id: h.hierarchy.id, site_id: @site.id) %>
                                <% @audiencemessage.each do |m| %>
                                  <tr>
                                    <td scope="row" width="30%"><h4><%= m.audience.name %></h4></td>
                                    <td><p><%= m.message %></p></td>
                                  </tr>
                                <% end %>

                              </tbody>
                            </table>


                              <!-- <p><img style="width:100%;" src="http://contentmodel-jci-assets.s3.amazonaws.com/images/WebFootprint_HighLevel_v4.png"></p> -->
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                          </div>

                        </div>
                      </div>




      <% end %>
        <hr>
      <h4>KPI</h4>
        <%= @thistemplate.kpi %>
      <hr>
      <h4>Likely Task</h4>
      <%= @thistemplate.likely_task %>
        <hr>
      <h4>Personalization Needs</h4>
      <%= @thistemplate.personalization_needs %>
        <hr>
      <h4>Creation Guidelines</h4>
      <%= @thistemplate.creation_guidelines %>

		</div>
		<div class="col-sm-9">
      <h1><%= @thistemplate.name %>

        <% if @thistemplate.existing == true %>
        <span class="badge badge-light">Existing</span>
        <% else %>
        <% end %>
        <br><small class="text-muted">Page Template        </small>
      </h1>

      <% if @thistemplate.document.blank? == false %>
      <%= link_to "Download Page Requirements Document (PRD)", @thistemplate.document, :class => "btn btn-info", target: "_blank" %>
      <% else %>
      <% end %>

      <% if @thistemplate.image.blank? == false %>
      <%= link_to "View Layout", @thistemplate.image, :class => "btn btn-info", target: "_blank" %>
      <% else %>
      <% end %>

        <h5 style="margin-top:30px;">Components</h5>
        <% @cinstance = TemplateComponent.order(:position).includes(:component, :template).references(:component, :template).where ({template_id: @thistemplate.id}) %>
        <ol>
          <!-- top version includes component instance ID for debugging -->
          <%#= safe_join ( @cinstance.all.map { |x| ["<li>".html_safe, x.id, " ", link_to(x.component.name, text_item_index_path(:id => x.component.id, :instance => x.id, :template => x.template.id, :page => @thispage.id, :site => @site.id)),"</li>".html_safe] }) %>
          <%= safe_join ( @cinstance.all.map { |x| ["<li>".html_safe, link_to(x.component.name, component_path(:id => x.component.id, :template => x.template.id, :site => @site.id)),"</li>".html_safe] }) %>
        </ol>

        <!-- <h5>Pages Using This Template</h5> -->
        <%# @pages = PageTemplateMappings.order(:page_id).includes(:page).references(:page).where template_id: @thistemplate.id %>
        <ol style="margin-top:30px;">
          <!-- top version includes component instance ID for debugging -->
          <%#= safe_join ( @cinstance.all.map { |x| ["<li>".html_safe, x.id, " ", link_to(x.component.name, text_item_index_path(:id => x.component.id, :instance => x.id, :template => x.template.id, :page => @thispage.id, :site => @site.id)),"</li>".html_safe] }) %>
          <%#= safe_join ( @pages.all.map { |a| ["<li>".html_safe, link_to(a.page.name, page_path(:id => a.page.id, :site => @site.id)),"</li>".html_safe] }) %>
        </ol>
<!--
        <% @thistemplate.components.each do |c| %>
            <a id="<%= c.name %>"></a>
            <h3><%= c.name %> <small class="text-muted">Component</small></h3>

            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">Attribute</th>
                  <th scope="col">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td scope="row">Personalization</td>
                  <td><i><%= c.personalization_rules %></i></td>
                </tr>
                <tr>
                  <td scope="row">Goal</td>
                  <td><i><%= c.goal %></i></td>
                </tr>
                <tr>
                  <td scope="row">CTA</td>
                  <td><i><%= c.cta %></i></td>
                </tr>
              </tbody>
            </table>



        <% end %> -->



		</div>
	</div>
  	<hr>
  <div class="row">
    <div class="col-sm">

        <%= render "footer" %>

    </div>
  </div>
